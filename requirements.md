# 音声自動カルテシステム要件定義書
## 飯田クリニック向け音声自動カルテシステム

### 1. プロジェクト概要
飯田クリニック（https://iida-clinic.net）向けの音声自動カルテシステムを開発する。
診察中の医師と患者の会話を自動的に医療記録として転記し、スプレッドシートに出力するシステム。

### 2. クリニック情報
- **クリニック名**: 芦屋Rいいだ内科クリニック
- **専門分野**: 内科・消化器内科・内視鏡内科
- **主要サービス**: 
  - 一般内科診療
  - 生活習慣病管理
  - 胃・大腸カメラ検査
  - ピロリ菌検査・除菌
  - 運動療法（RACS）
  - 栄養療法（オーソモレキュラー療法）
  - 東洋医学・漢方治療

### 3. システム要件

#### 3.1 機能要件
1. **音声録音機能**
   - ブラウザベースの音声録音
   - リアルタイム音声キャプチャ
   - 録音開始/停止/一時停止機能

2. **音声処理・転記機能**
   - Difyエージェントとの連携
   - 日本語医療用語の認識
   - 消化器内科専門用語の対応
   - 医師・患者の発言者識別

3. **カルテ生成機能**
   - 構造化された医療記録の生成
   - 症状、診断、処方、指導内容の分類
   - 標準的なカルテフォーマットでの出力

4. **スプレッドシート出力機能**
   - Google Sheetsへの自動出力
   - 患者情報、診察日時、診察内容の整理
   - 検索・フィルタリング機能

#### 3.2 技術要件
1. **フロントエンド**
   - React + TypeScript
   - Web Audio API for 音声録音
   - レスポンシブデザイン
   - 日本語UI

2. **バックエンド**
   - FastAPI (Python)
   - Dify API連携
   - Google Sheets API連携
   - 音声ファイル処理

3. **AI処理**
   - Difyエージェント
   - 医療用語辞書
   - 文脈理解機能

#### 3.3 セキュリティ要件
- 医療情報の暗号化
- アクセス制御
- 監査ログ
- GDPR/個人情報保護法対応

### 4. システムフロー
```
1. Web画面で音声録音開始
2. 音声データをバックエンドに送信
3. バックエンドからDifyエージェントに音声データ送信
4. Difyエージェントで音声→テキスト変換＋医療記録構造化
5. 構造化されたデータをバックエンドで受信
6. Web画面で結果表示・編集可能
7. 確認後、Google Sheetsに自動出力
```

### 5. 出力フォーマット（スプレッドシート）
| 列名 | 内容 |
|------|------|
| 診察日時 | YYYY-MM-DD HH:MM |
| 患者ID | 患者識別番号 |
| 主訴 | 患者の主な訴え |
| 現病歴 | 現在の病気の経過 |
| 身体所見 | 診察での所見 |
| 診断 | 医師の診断 |
| 処方 | 処方薬・治療法 |
| 指導内容 | 生活指導・注意事項 |
| 次回予約 | 次回診察予定 |
| 備考 | その他特記事項 |

### 6. 対応する医療用語例
- 消化器系: 胃炎、胃潰瘍、逆流性食道炎、過敏性腸症候群
- 内科系: 高血圧、糖尿病、脂質異常症、メタボリックシンドローム
- 検査系: 胃カメラ、大腸カメラ、ピロリ菌検査、血液検査
- 治療系: 投薬、食事療法、運動療法、生活指導

### 7. ユーザビリティ要件
- 直感的な操作画面
- 録音状態の視覚的フィードバック
- エラーハンドリング
- オフライン対応（一時保存）
