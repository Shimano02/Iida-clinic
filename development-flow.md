# 開発フロー計画書
## 音声自動カルテシステム開発フロー

### Phase 1: プロジェクト初期設定
1. **プロジェクト構造作成**
   - フロントエンド（React + TypeScript）
   - バックエンド（FastAPI）
   - 環境設定ファイル

2. **開発環境構築**
   - 必要なライブラリのインストール
   - API設定
   - 開発サーバー起動確認

### Phase 2: バックエンド開発
1. **FastAPI基盤構築**
   - 基本的なAPI構造
   - CORS設定
   - 音声ファイルアップロード機能

2. **Dify連携機能**
   - Dify API接続
   - 音声データ送信機能
   - レスポンス処理

3. **Google Sheets連携**
   - Google Sheets API設定
   - データ書き込み機能
   - フォーマット設定

### Phase 3: フロントエンド開発
1. **基本UI構築**
   - 録音画面
   - 結果表示画面
   - ナビゲーション

2. **音声録音機能**
   - Web Audio API実装
   - 録音制御（開始/停止/一時停止）
   - 音声ファイル生成

3. **API連携**
   - バックエンドとの通信
   - ファイルアップロード
   - 結果表示

### Phase 4: AI処理（Dify）設定
1. **Difyエージェント設定**
   - 医療用語辞書の設定
   - 音声認識モデルの調整
   - 出力フォーマットの定義

2. **医療記録構造化**
   - 症状・診断・処方の分類
   - 発言者識別
   - 文脈理解の向上

### Phase 5: 統合テスト
1. **エンドツーエンドテスト**
   - 音声録音→Dify処理→スプレッドシート出力
   - 各種医療用語での動作確認
   - エラーハンドリングテスト

2. **ユーザビリティテスト**
   - 操作性の確認
   - レスポンス時間の測定
   - UI/UXの改善

### Phase 6: デプロイメント
1. **本番環境構築**
   - バックエンドデプロイ（Fly.io）
   - フロントエンドデプロイ
   - 環境変数設定

2. **セキュリティ設定**
   - HTTPS設定
   - 認証機能
   - データ暗号化

### Phase 7: ドキュメント作成
1. **ユーザーマニュアル**
   - 操作手順書
   - トラブルシューティング
   - FAQ

2. **技術ドキュメント**
   - API仕様書
   - システム構成図
   - 保守手順書

### 開発スケジュール（推定）
- Phase 1-2: バックエンド基盤（2-3時間）
- Phase 3: フロントエンド開発（2-3時間）
- Phase 4: Dify設定・調整（1-2時間）
- Phase 5: 統合テスト（1時間）
- Phase 6: デプロイメント（1時間）
- Phase 7: ドキュメント（30分）

### 技術スタック詳細
```
Frontend:
- React 18 + TypeScript
- Vite (ビルドツール)
- Tailwind CSS (スタイリング)
- Web Audio API (音声録音)

Backend:
- FastAPI (Python)
- Poetry (依存関係管理)
- Pydantic (データバリデーション)
- httpx (HTTP クライアント)

External APIs:
- Dify API (AI処理)
- Google Sheets API (データ出力)
- Web Speech API (音声認識補助)

Deployment:
- Frontend: Vercel/Netlify
- Backend: Fly.io
- Database: In-memory (プロトタイプ)
```

### リスク管理
1. **技術的リスク**
   - Dify API制限
   - 音声品質による認識精度
   - ブラウザ互換性

2. **対策**
   - フォールバック機能
   - 音声品質チェック
   - 複数ブラウザテスト

### 成功指標
- 音声認識精度: 90%以上
- レスポンス時間: 30秒以内
- UI操作性: 直感的操作可能
- データ出力: 正確なフォーマット
